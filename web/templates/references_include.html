{% autoescape off %}

    {% if references %}

        <div class="row-fluid">
            <div class="span2">
                <div id="controls">

                    <div class="well well-small">
                        <!-- sort -->
                        <div>
                            <p><h4>Search &amp; Filter</h4></p>
                            <div class="btn-group">
                                <a class="btn dropdown-toggle span12" data-toggle="dropdown" href="#" align="right">
                                    Sort by
                                    <span class="caret"></span>
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a href="{{ request.path }}?sort=authors">Author list</a></li>
                                    <li><a href="{{ request.path }}?sort=year">Year</a></li>
                                    <li><a href="{{ request.path }}?sort=journal">Journal</a></li>
                                    <li><a href="{{ request.path }}?sort=title">Title</a></li>
                                </ul>
                            </div>
                            <!-- filter -->
                            <div style="padding-top:5px">
                                <br/><br/>

                                <form id="search" action="{{ URL_PREPENDER }}/search">
                                    <input id="referencefilter" style="width:90%;" type="text" name="q"
                                           placeholder="Type to filter...">
                                </form>
                            </div>
                        </div>
                        <!-- note -->

                    </div>

                    {% if owners != 0 and user.is_authenticated %}
                        <div style="padding-top:5px">

                            {% url 'enquiry' taxonomy.id as suggest_url %}
                            <a onclick="showSuggestBox('taxonomy', '{{ suggest_url }}')" class="btn">Suggest
                                addition/correction</a>
                        </div>
                    {% endif %}


                    <div style="padding-top:5px">

                        <a href="{{ URL_PREPENDER }}/taxonomy/download/{{ taxonomy.id }}" class="btn btn-blue"
                           style="width: 82%">Download
                            BibTeX</a>
                    </div>
                <div class="clearfix"></div><br/>
                <p>Reference list last updated on {{ taxonomy.last_updated }}</p>
                </div>
            </div>

            <div class="span10">

                {% for reference in references %}
                    <div class="well taxonomy-well reference_box">

                        <p class="title">{{ reference.title }}</p>

                        <p class="authors">{{ reference.authorsAsText }}</p>

                        <p><span class="journal">{{ reference.journal }}</span>{% if reference.year > 0 %}
                            <span class="year">{% if reference.journal %} {% endif %}{{ reference.year }}</span>{% endif %}
                        </p>


                        {% if reference.url %}
                            <a href="{{ reference.url }}" target="_blank" class="btn btn-small">View Paper</a>
                        {% endif %}


                        <a href="{{ URL_PREPENDER }}/reference/{{ reference.id }}?currentPage={{ request.path }}" class="btn btn-small">View Reference</a>


                        {% if owners != 0 %}
                            <a onclick="showSuggestBox('reference', '{{ URL_PREPENDER }}/enquiry/{{ taxonomy.id }}/{{ reference.id }}/')"
                               class="btn btn-yellow btn-small"><i class="icon-exclamation-sign icon-white"></i> Report
                                error</a>{% endif %}
                        {% if user.is_superuser or ownerLoggedIn %}
                            <a onclick="showDeleteWindow({{ reference.id }})" class="btn btn-small btn-danger"><i
                                    class="icon-remove-sign icon-white"></i> Delete</a>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>

        <script language="javascript">

            $(document).ready(function () {

                // filter functionality
                var rf_box = $('#referencefilter');

                $.extend($.expr[':'], {
                    'containsi': function (elem, i, match, array) {
                        return (elem.textContent || elem.innerText || '').toLowerCase()
                                .indexOf((match[3] || "").toLowerCase()) >= 0;
                    }
                });

                rf_box.keyup(function () {
                    if (rf_box.val().length > 0) {
                        $(".reference_box:not(:containsi('" + rf_box.val() + "'))").each(function () {
                            $(this).hide();
                        });
                        $(".reference_box:containsi('" + rf_box.val() + "')").each(function () {
                            $(this).show();
                        });
                    }
                    else {
                        $(".reference_box").show();
                    }
                });

            });

        </script>

    {% else %}

        There are no references.

    {% endif %}

{% endautoescape %}
